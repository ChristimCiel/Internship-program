# Warning control
import warnings
warnings.filterwarnings('ignore')

from crewai import Agent, Task, Crew
from crewai.llm import LLM
import os
from utils import get_perplexity_api_key
from dotenv import load_dotenv, find_dotenv
from openai import OpenAI

# Now environment variables are loaded
load_dotenv()

perplexity_api_key = get_perplexity_api_key()
os.environ["PERPLEXITY_API_KEY"] = perplexity_api_key
llm = LLM(
    provider="perplexity",  # Add provider specification
    api_key=perplexity_api_key,
    base_url="https://api.perplexity.ai",
    model="llama-3.1-sonar-large-128k-online",
    temperature=0.7  # Add temperature parameter
)

from crewai_tools import (
  FileReadTool
)


AiMochi_Knowledge = Agent(
    role="AiMochi_Knowledge",
    goal="你只需要傳送以下一模一樣的內容給 SEO_Writer，不需要解釋，也不需要多說任何話。"
         "你的任務是為 SEO_Writer 提供 AIMochi 所有服務的詳細資訊，"
         "幫助 SEO_Writer 深入了解 AIMochi 的功能及使用方法，以撰寫專業且具吸引力的文章。"
         "	1.	服務介紹：詳細解釋 AIMochi 提供的服務，包括語音轉文字、音頻轉文字、記筆記 AI、文章摘要、視頻轉文字、編輯生成的文本、多語言翻譯等。幫助 SEO_Writer 清晰理解每項服務的具體功能和用途。"
	     "  2.	保持專業性：以專業、清晰的方式整理 AIMochi 的特點，適合公開宣傳。",

    backstory= "你只需要傳送以下一模一樣的內容給 SEO_Writer，不需要解釋，也不需要多說任何話。"
               "AIMochi 提供多種 AI 驅動的語音與文本處理服務，旨在幫助使用者輕鬆進行文字轉錄、"
               "翻譯、摘要等。你的工作是確保 SEO_Writer 對這些服務有全面的了解，便於 SEO_Writer "
               "能夠撰寫出符合 AIMochi 品牌形象的專業 SEO 文章，並有效傳達 AIMochi 的核心價值與使用便捷性。",

    allow_delegation=False,
    verbose=True,
    llm=llm
)

SEO_Writer = Agent(
    role="SEO Writer",
    goal=
    #"根據 {keyword} 撰寫文章。以詼諧幽默、雙關語、以及當下網路流行語來撰寫，"
    #     "打造有趣但具備專業性的文章。文章的目標是增強讀者對內容的參與感。為此，文章必須具備可靠的資料來源、納入 {keyword} 。"

    #     "撰寫指引："

    #     "1.	資料來源與連結：確保所有數據、事實均來自可靠來源，並提供可點擊的連結以供讀者進一步了解，增強內容的可信度和專業性。"
    #     "2.	延伸撰寫：以 {keyword} 和 AIMochi_Agent 所提供的內容為基礎，針對標題 {keyword} 進行撰寫，使文章具有深度並能覆蓋相關主題。"
    #     "3.	繁體中文：請以繁體中文（台灣）撰寫，主要讀者為台灣地區。"
    #     "4. 文章結構：以編寫論文的方式進行撰寫，不要有過多的列點，每個段落至少 300 字，並讓讀者可以感受文章的連貫性。"
    "主要目標："
         "	1.	撰寫一篇專業、具吸引力且符合 SEO 優化的文章，圍繞關鍵字 {keyword} 展開，並以 85% 的內容深入解析該主題。"
         "	2.	創建與 AIMochi 服務密切相關的內容，佔文章的 15%，展示其功能價值及應用場景，確保與 {keyword} 有自然且緊密的結合。"
         "	3.	結合當前市場趨勢、真實案例與讀者需求，設計引人入勝的故事化敘述，吸引目標讀者參與並提高轉化率。"

         "次要目標："
         "	•	強調 AIMochi 作為 AI 工具的專業形象，提升品牌的市場辨識度。"
         "	•	增強文章在搜尋引擎上的曝光率，吸引台灣地區的職場人士、內容創作者及教育工作者。"

         "執行重點："
         "	•	確保文章符合以下比例："
         "	•	85%：解析與 {keyword} 相關的行業現象、案例或挑戰，展示深入的專業洞見。"
         "	•	15%：結合 AIMochi 的應用，透過實際服務介紹、使用案例及功能解析展現其價值。"
         "	•	運用幽默詼諧、雙關語風格與網路流行語，確保讀者享受閱讀並願意分享文章。", 
    
    backstory= 
            #    "目標在於撰寫一篇具知識性和專業性的文章，旨在提供讀者豐富的資訊，而非直接推銷 AIMochi 的服務。"
            #    "讀者能夠從你所撰寫的文章中學習到關於 {keyword} 的知識。"
            #    "讀者可從你文章中的連結訪問相關數據或事實來源。透過 {keyword} 所查到的數據與 AIMochi_Agent 提供的服務資訊，你將編寫出一篇能"
            #    "解答讀者疑問且容易在搜尋引擎中被發現的文章。"
            #    "請以繁體中文（台灣）撰寫，主要讀者為台灣地區。"
            #    "文章結構：以編寫論文的方式進行撰寫，不要有過多的列點，每個段落至少 300 字，並讓讀者可以感受文章的連貫性。"
            "背景故事："
            "SEO_Writer 是一位專注於數位內容創建的專家，具有豐富的 SEO 優化經驗，致力於以創新的方式撰寫專業文章，讓品牌內容在搜尋引擎與社群平台上脫穎而出。"

            "核心動機："
                "	1.	AIMochi 作為一款 AI 工具，已成功進入語音轉文字、記筆記 AI、多語言翻譯等市場領域。SEO_Writer 的任務是讓更多人了解 AIMochi 的價值，並引導讀者採取行動，例如體驗 AIMochi 的服務。"
                "	2.	透過撰寫與 {keyword} 相關的內容，SEO_Writer 將 AIMochi 的功能自然融入，展示其如何解決行業挑戰並提升用戶的生產力。"
                "	3.	SEO_Writer 擁有將技術性內容轉化為讀者喜聞樂見文章的能力，透過數據支持、真實案例與故事化敘述，幫助 AIMochi 在市場中建立信任與專業形象。"

            "任務環境："
                "	1.	目標讀者主要來自台灣，包括職場人士、內容創作者及教育工作者，期待解決高效工作與多語言協作需求。"
                "	2.	市場對 AIMochi 提供的服務（語音轉文字、摘要生成、多語言翻譯等）的需求日益增加，尤其是隨著 AI 工具在工作場景中的普及。"
                "	3.	搜尋引擎演算法偏好結構化內容與高分享性的文章，因此 SEO_Writer 必須確保內容具備邏輯性、可讀性與互動性。",

    allow_delegation=False,
    verbose=True,
    llm = llm
)

# =========================================================================================================================================================
#Create Tasks

AIMochi_Bot = Task(
    description=(
        "你只需要傳送以下一模一樣的內容給 SEO_Writer，不需要解釋，也不需要多說任何話。"
        "你的任務是為 SEO_Writer 提供 AIMochi 服務的詳細資訊，使其能夠深入了解 AIMochi 的各項功能和使用流程。請依據以下指導方針完成任務："

        "1.	服務詳解：提供 AIMochi 所有服務的具體說明，包括語音轉文字、音頻轉文字、記筆記 AI、文章摘要、視頻轉文字、文本編輯生成、多語言翻譯等功能，並詳細解釋每項服務的用途。"
        "2. 任務目標：此任務的目的是幫助 SEO_Writer 清楚了解 AIMochi 的服務，便於其撰寫出具備專業性和吸引力的文章，並向讀者傳遞 AIMochi 的功能價值。"
    ),
    expected_output=    "你只需要傳送以下的內容給 SEO_Writer，不需要解釋，也不需要多說任何話。"
                        "1.	詳細服務清單：解釋 AIMochi 的服務，強調其用途與功能，使 SEO_Writer 對各功能有全面理解。"
                        "2.	專業且易讀的文字：輸出內容應條理分明，具備專業性，撰寫出一篇專業文章。",
    agent=AiMochi_Knowledge,
)

SEO_Writer_Bot = Task(
    description=(
        # "你的目標是根據 {keyword} 與前述所提供的內容，撰寫出一篇圍繞標題 {keyword} 的專業文章。"
        # "該文章應兼具詼諧幽默與雙關語風格，並搭配當下網路流行語，旨在吸引讀者，增強文章的參與感與分享性。同時，內容需包含標題 {keyword} 具故事性、實際案例"
        # "的結構。文章字數應控制在 3000 ~ 3500 token 之間。"
        # "任務目標：提供讀者豐富的資訊與見解，建立 AIMochi 的品牌專業形象，並提高搜尋引擎上的曝光率。內容必須具備可靠的數據、參考來源，提升讀者信任度。"
        # "請以繁體中文（台灣）撰寫，主要讀者為台灣地區。"
        # "文章結構：以編寫論文的方式進行撰寫，不要有過多的列點，每個段落至少 300 字，並讓讀者可以感受文章的連貫性。"
        "你的目標是根據關鍵字 {keyword} 撰寫一篇專業文章，透過有趣、吸引讀者的方式深入探討 {keyword} 的背景"
        "、價值與相關案例。同時，文章需結合 AIMochi 的功能，巧妙融入 AIMochi 的實際應用場景與服務價值，展示其在解決與 {keyword} 相關問題中的關鍵角色。"

        "文章需以 85% 聚焦在 {keyword} 的核心內容上，包括趨勢、挑戰、成功案例與行業應用；其餘 15% 強調 AIMochi 的相關服務（如語音轉文字、記筆記 AI、摘要功能等）如何提升讀者的效率或應對 {keyword} 中的特定需求。"

        "整體語氣應詼諧幽默，結合雙關語和網路流行語，以增加內容的吸引力與分享性，並建立 AIMochi 的品牌專業形象。"
    ),
    # expected_output = "文章結構與要素（總字數 3000 - 3500 Token）："

    #     "•	必須包含關鍵字 {keyword} 和 AIMochi_Agent 所提供的內容"
    #     "•	設計吸引讀者點擊的標題"
    #     "•	使用數據支持事實或與時事連結的話題的開場白或提出問題以引出標題"
    #     "•	介紹一個與標題 {keyword} 相關的有趣現象或最新趨勢"
    #     "•	運用故事化敘述抓住讀者的注意力"
    #     "•	透過 {keyword} 和 AIMochi_Agent 的內容，提出具體案例或小故事以深入探討"
    #     "•	使用對比手法強調標題的關鍵價值或獨特之處"
    #     "•	提供與標題 {keyword} 高度相關的連結和參考資料，增強讀者信任感"
    #     "•	使用互動性提問，引導讀者參與思考"
    #     "•	將個人現象或小故事與更廣泛的社會趨勢聯繫起來"
    #     "•	加入社會現象解讀，探討更深層次的原因或影響"
    #     "•	使用循序漸進的論證將各論點統一起來"
    #     "•	得出對標題的結論或提出更大的洞見"
    #     "•	留下思考空間或發出行動呼籲，引導讀者進行下一步"

    # "注意事項："

    #     "•	段落結構：依循段落設計的邏輯進行撰寫。"
    #     "•	語氣風格：語氣詼諧幽默，使用雙關語及網路流行語，以生動有趣的方式呈現專業知識。"
    #     "•	文案連貫性：確保各部分之間過渡自然，故事和例子引人入勝，能引起讀者共鳴。"
    #     "•	語言使用：所有內容需以繁體中文（台灣）撰寫，主要讀者為台灣地區。"
    #     "•	直接將參考資料連結附在文章中，以增強內容的可信度。"
    #     "•	文章結構：以編寫論文的方式進行撰寫，不要有過多的列點，每個段落至少 300 字，並讓讀者可以感受文章的連貫性。"
    expected_output = "文章結構與內容要素："

        "文章結構與內容要素："

        "1.	關鍵字 {keyword} 的引導與核心介紹："
            "•	開場以數據、趣味現象或當下熱門趨勢引出 {keyword}。"
            "•	分析 {keyword} 的背景、行業重要性或其影響力，並引導讀者認識其價值。"
            "•	提問式引導，例如：「在這個快節奏的時代，{keyword} 是否已成為成功的關鍵？」。"
        "2.	專注於 {keyword} 的核心內容（85%）："
            "•	深入解析與 {keyword} 相關的行業現象或挑戰："
            "•	提供具體案例或故事化敘述，展現 {keyword} 的真實應用或影響。"
            "•	探討 {keyword} 的成功與失敗經驗，並提供實用洞見。"
            "•	使用對比手法或數據支持，說明 {keyword} 的獨特價值與未來趨勢。"
        "3.	結合 AIMochi 的應用場景(15%）："
            "•	AIMochi 如何解決 {keyword} 的相關需求："
            "•	描述 AIMochi 的語音轉文字、記筆記 AI、摘要生成等功能如何幫助讀者。"
            "•	提供 AIMochi 的實際使用案例，例如如何協助處理會議逐字稿或跨語言內容協作。"
        "4.	數據支持與參考資料："
            "•	提供與 {keyword} 相關的市場數據或成功案例，增強文章可信度。"
            "•	引用 AIMochi 用戶的評價或使用數據，說明其對解決 {keyword} 挑戰的貢獻。"
        "5.	行動呼籲與讀者參與："
            "•	提問式結尾，例如：「你覺得 AIMochi 是否能讓 {keyword} 的實現更加高效？」"
            "•	行動呼籲，鼓勵讀者嘗試 AIMochi，例如：「現在就加入 AIMochi，讓 AI 改變你的工作方式！」"
    "注意事項："
        "1.	內容比例："
            "•	85% 圍繞 {keyword}，確保主題的深度與專業性。"
            "•	15% 聚焦 AIMochi，展示其與 {keyword} 的結合點及應用價值。"
        "2.	語氣與風格："
            "•	語氣幽默、流暢，結合雙關語與網路流行語，吸引年輕與專業讀者。"
            "•	確保段落邏輯清晰，數據與案例結構嚴密。"
        "3.	專業性與讀者參與："
            "•	文中需引發讀者共鳴，並提供實際解決方案或應用建議。"
            "•	強調 AIMochi 作為專業工具的核心價值，避免過度廣告化。"
        "4.	適用讀者："
            "•	針對繁體中文（台灣）讀者，包括職場人士、內容創作者及 AI 工具愛好者。"
    "語氣與風格："
        "•	語氣： 詼諧幽默，適度使用雙關語，融入網路流行語以吸引年輕與專業讀者。"
        "•	連貫性： 各段落需自然銜接，數據與案例需邏輯嚴密，並與 AIMochi 的核心價值保持一致。"
        "•	目標讀者： 繁體中文（台灣），針對職場人士、內容創作者、教育工作者及對 AI 工具感興趣的讀者群。",

    output_file=f"Expert{'_' + str(len([f for f in os.listdir() 
                                        if f.startswith('Expert')]) - 1).zfill(2) 
                                            if len([f for f in os.listdir() 
                                                if f.startswith('Expert')]) > 1 
                                                else ''}.txt",
    agent=SEO_Writer,
    )


crew = Crew(
    agents=[AiMochi_Knowledge, SEO_Writer],
    tasks=[AIMochi_Bot, SEO_Writer_Bot],
    verbose=True
)

keyword = input("請輸入關鍵字：")
result = crew.kickoff(inputs={"keyword": keyword})
